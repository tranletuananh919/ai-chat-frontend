<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>T∆∞ v·∫•n tr·ª±c tuy·∫øn</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #e5e7eb; }
    #chat-box::-webkit-scrollbar { width: 8px; }
    #chat-box::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
    #chat-box::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    #chat-box::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

  <div class="flex bg-white rounded-3xl shadow-2xl overflow-hidden w-full max-w-7xl h-[800px]">

    <!-- Sidebar tr√°i -->
    <div class="w-1/4 bg-gray-100 p-6 flex flex-col border-r border-gray-200">
      <h1 class="text-3xl font-bold text-blue-600 mb-6">MEDIVERSE</h1>
      <h2 class="text-2xl font-semibold text-gray-800 mb-4">T∆∞ v·∫•n tr·ª±c tuy·∫øn</h2>
      
      <!-- Search bar -->
      <div class="relative mb-6">
        <input type="text" placeholder="Q Search" class="w-full p-3 pl-10 rounded-xl bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
      </div>

      <!-- Menu -->
      <ul id="main-menu" class="space-y-3 font-medium text-lg">
        <li id="menu-doctor" class="p-3 rounded-xl hover:bg-gray-200 cursor-pointer flex items-center space-x-3 text-gray-700">
          <i class="fas fa-user-md"></i>
          <span>Chat v·ªõi B√°c sƒ©</span>
        </li>
        <li id="menu-ai" class="p-3 rounded-xl hover:bg-gray-200 cursor-pointer flex items-center space-x-3 text-gray-700">
          <i class="fas fa-robot"></i>
          <span>Chat v·ªõi Chatbot AI</span>
        </li>
        <li id="menu-history" class="p-3 rounded-xl hover:bg-gray-200 cursor-pointer flex items-center space-x-3 text-gray-700">
          <i class="fas fa-history"></i>
          <span>L·ªãch s·ª≠ tr√≤ chuy·ªán</span>
        </li>
      </ul>

      <!-- Container list conversation -->
      <div id="history-section" class="overflow-hidden transition-all duration-500 max-h-0"></div>

      <!-- Online Doctors -->
      <div class="mt-auto pt-6 border-t border-gray-300">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">B√°c sƒ© ƒëang online</h3>
        <div class="flex items-center space-x-3 p-3 bg-gray-200 rounded-xl cursor-pointer">
          <div class="relative">
            <i class="fas fa-user-circle text-4xl text-gray-500"></i>
            <span class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 rounded-full border-2 border-white"></span>
          </div>
          <div>
            <p class="font-semibold text-gray-800">Bs. Nguy·ªÖn VƒÉn A</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Khung chat -->
    <div class="flex-1 flex flex-col">
      <!-- Header -->
      <div class="p-6 border-b border-gray-200 flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <div class="relative">
            <i class="fas fa-robot text-4xl text-blue-600"></i>
            <span class="absolute bottom-0 right-0 h-3 w-3 bg-green-500 rounded-full border-2 border-white"></span>
          </div>
          <div>
            <h2 class="text-xl font-bold text-gray-800">T∆∞ v·∫•n tr·ª±c tuy·∫øn</h2>
            <p class="text-sm text-gray-500 font-medium">Chatbot AI</p>
          </div>
        </div>
      </div>

      <!-- Chat box -->
      <div id="chat-box" class="flex-1 overflow-y-auto p-6 space-y-4"></div>

      <!-- Input -->
      <div class="p-6 border-t border-gray-200 flex items-center space-x-3 bg-white">
        <input type="text" id="message-input" placeholder="Nh·∫≠p tin nh·∫Øn..." class="flex-1 p-4 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <button id="send-button" class="p-4 bg-blue-600 text-white rounded-xl shadow-md hover:bg-blue-700 transition duration-300">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>

    <!-- Sidebar ph·∫£i -->
    <div class="w-1/4 bg-gray-50 p-6 flex flex-col border-l border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800 mb-6">Th√¥ng tin b√°c sƒ©</h2>
      <div class="bg-white p-6 rounded-2xl shadow-sm mb-6">
        <div class="flex items-center space-x-4 mb-4">
          <i class="fas fa-robot text-5xl text-blue-600"></i>
          <div>
            <p class="font-bold text-lg text-gray-800">Chatbot AI</p>
            <p class="text-sm text-gray-500">H·ªó tr·ª£ y t·∫ø</p>
          </div>
        </div>
        <div class="text-gray-600 space-y-2">
          <p class="font-medium text-gray-800">N·ªôi khoa</p>
          <p>H·ªó tr·ª£ t∆∞ v·∫•n th√¥ng tin s·ª©c kh·ªèe c∆° b·∫£n</p>
        </div>
      </div>
    
      <div class="flex flex-col space-y-4">
        <h3 class="text-xl font-semibold text-gray-800">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</h3>
        <div class="faq-item bg-gray-200 p-4 rounded-xl cursor-pointer hover:bg-gray-300 transition duration-200">
          <p class="text-gray-800 font-medium">T√¥i n√™n u·ªëng thu·ªëc nh∆∞ th·∫ø n√†o?</p>
        </div>
        <div class="faq-item bg-gray-200 p-4 rounded-xl cursor-pointer hover:bg-gray-300 transition duration-200">
          <p class="text-gray-800 font-medium">Tri·ªáu ch·ª©ng n√†y c√≥ ƒë√°ng lo kh√¥ng?</p>
        </div>
      </div>
    </div>


  <!-- Script -->
  <script>
    const API_BASE = "https://ai-chat-production-1401.up.railway.app"; 
    const userId = "user001"; // demo

    const chatBox = document.getElementById('chat-box');
    const input = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-button');

    let activeConversationId = null;
    let historyVisible = false;

    function addMessage(role, content) {
      const wrapper = document.createElement('div');
      wrapper.className = "flex w-full";
      const div = document.createElement('div');
      if (role === "user") {
        wrapper.classList.add("justify-end");
        div.className = "bg-blue-600 text-white rounded-xl p-4 max-w-sm break-words shadow-md";
        div.textContent = content;
      } else {
        wrapper.classList.add("justify-start");
        div.className = "bg-gray-200 text-gray-800 rounded-xl p-4 max-w-sm break-words shadow-sm";
        div.innerHTML = marked.parse(content);
      }
      wrapper.appendChild(div);
      chatBox.appendChild(wrapper);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function setActiveMenu(id) {
      document.querySelectorAll("ul li").forEach(li => {
        li.classList.remove("bg-blue-100", "text-blue-700");
        li.classList.add("text-gray-700");
      });
      const active = document.getElementById(id);
      if (active) {
        active.classList.add("bg-blue-100", "text-blue-700");
        active.classList.remove("text-gray-700");
      }
    }

    // Chat AI: t·∫°o h·ªôi tho·∫°i m·ªõi
    document.getElementById("menu-ai").addEventListener("click", async () => {
      setActiveMenu("menu-ai");
      chatBox.innerHTML = "";
      try {
        const res = await fetch(`${API_BASE}/conversation`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId })
        });
        const data = await res.json();
        activeConversationId = data.id;
        addMessage("assistant", "B·∫°n ƒëang b·∫Øt ƒë·∫ßu m·ªôt cu·ªôc tr√≤ chuy·ªán m·ªõi v·ªõi Chatbot AI ü§ñ");
      } catch (err) {
        console.error("L·ªói t·∫°o h·ªôi tho·∫°i:", err);
      }
    });

    // G·ª≠i tin nh·∫Øn
    async function sendMessage() {
      const message = input.value.trim();
      if (!message || !activeConversationId) return;
      addMessage("user", message);
      input.value = "";

      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'flex justify-start';
      loadingDiv.innerHTML = `<div class="bg-gray-200 text-gray-800 rounded-xl p-4 max-w-sm break-words animate-pulse shadow-sm">ƒêang tr·∫£ l·ªùi...</div>`;
      chatBox.appendChild(loadingDiv);
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const res = await fetch(`${API_BASE}/chat/${activeConversationId}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId, question: message })
        });
        const data = await res.json();
        loadingDiv.remove();
        if (data?.answer) addMessage("assistant", data.answer);
        else addMessage("assistant", "(Kh√¥ng nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi)");
      } catch (err) {
        console.error("L·ªói g·ª≠i tin:", err);
        loadingDiv.remove();
        addMessage("assistant", "(C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau)");
      }
    }
    sendBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

    // L·ªãch s·ª≠ h·ªôi tho·∫°i
    const historySection = document.getElementById("history-section");
    document.getElementById("menu-history").addEventListener("click", loadConversationList);

    async function loadConversationList() {
      try {
        if (historyVisible) {
          historySection.style.maxHeight = historySection.scrollHeight + "px";
          requestAnimationFrame(() => { historySection.style.maxHeight = "0px"; });
          historyVisible = false;
          return;
        }
        const res = await fetch(`${API_BASE}/conversations/${userId}`);
        const data = await res.json();
        historySection.innerHTML = "";
        data.conversations.forEach(c => {
          const item = document.createElement("div");
          item.textContent = c.preview;
          item.className = "p-2 cursor-pointer rounded text-gray-700 hover:bg-gray-200";
          item.onclick = async () => {
            setActiveMenu("menu-history");
            activeConversationId = c.id;
            chatBox.innerHTML = "";
            document.querySelectorAll("#history-section div").forEach(el => {
              el.classList.remove("bg-blue-100", "text-blue-700");
              el.classList.add("text-gray-700");
            });
            item.classList.add("bg-blue-100", "text-blue-700");
            item.classList.remove("text-gray-700");
            const res2 = await fetch(`${API_BASE}/conversation/${c.id}`);
            const detail = await res2.json();
            detail.messages.forEach(m => addMessage(m.role, m.content));
          };
          historySection.appendChild(item);
        });
        historySection.style.maxHeight = "0px";
        requestAnimationFrame(() => {
          historySection.style.maxHeight = historySection.scrollHeight + "px";
        });
        historyVisible = true;
        setActiveMenu("menu-history");
      } catch (err) {
        console.error("L·ªói t·∫£i l·ªãch s·ª≠:", err);
      }
    }

    // FAQ click ‚Üí g·ª≠i c√¢u h·ªèi v√†o chatbot
    document.querySelectorAll(".faq-item").forEach(item => {
      item.addEventListener("click", async () => {
        const question = item.innerText.trim();
    
        // N·∫øu ch∆∞a c√≥ h·ªôi tho·∫°i ‚Üí t·∫°o m·ªõi ngay b·∫±ng API
        if (!activeConversationId) {
          try {
            const res = await fetch(`${API_BASE}/conversation`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ userId })
            });
            const data = await res.json();
            activeConversationId = data.id;
            setActiveMenu("menu-ai");
            chatBox.innerHTML = "";
            addMessage("assistant", "B·∫°n ƒëang b·∫Øt ƒë·∫ßu m·ªôt cu·ªôc tr√≤ chuy·ªán m·ªõi v·ªõi Chatbot AI ü§ñ");
          } catch (err) {
            console.error("L·ªói t·∫°o h·ªôi tho·∫°i:", err);
            return;
          }
        }
    
        // Sau khi c√≥ ID ‚Üí g·ª≠i c√¢u h·ªèi
        sendMessage(question);
      });
    });
  </script>
</body>
</html>


